<mvc:View
    controllerName="com.zeim.fatturazionepassiva.controller.Home"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:card="sap.f.cards"
    xmlns:form="sap.ui.layout.form"
    xmlns:mdc="sap.ui.mdc"
    xmlns:core="sap.ui.core"
    xmlns:fb="sap.ui.comp.filterbar"
    xmlns:table="sap.ui.table"
>
    <Page
        id="page"
        title="{i18n>title}"
    >
        <!-- Pannello filtro -->
        <Panel headerText="Filtri di ricerca">
            <fb:FilterBar
                id="filterBar"
                persistencyKey="myPersKey"
                useToolbar="false"
                search=".onFilterBarSearch"
                showGoOnFB="true"
                isRunningInValueHelpDialog="false"
            >
                <fb:filterGroupItems>
                    <fb:FilterGroupItem
                        name="Società"
                        label="Società"
                        groupName="General"
                        visibleInFilterBar="true"
                    >
                        <fb:control>
                            <Select
                                id="selectSocieta"
                                width="300px"
                                forceSelection="false"
                                items="{
                                    path: 'MCSocieta>/ZR_EIM_COMPANY'}"
                            >
                                <core:Item
                                    key="{MCSocieta>CompanyCode}"
                                    text="{MCSocieta>CompanyCode}"
                                />
                            </Select>
                        </fb:control>
                    </fb:FilterGroupItem>
                    <fb:FilterGroupItem
                        name="Fornitore"
                        label="Fornitore"
                        groupName="General"
                        visibleInFilterBar="true"
                    >
                        <fb:control>
                            <MultiInput
                                id="multiInputFornitore"
                                width="300px"
                                showValueHelp="true"
                                valueHelpRequest=".onValueHelpFornitore"
                                showSuggestion="true"
                                suggestionItems="{path: 'Fornitore>/zeim_search_supplier_data'}"
                                data-model="Fornitore"
                                data-key="Supplier"
                                data-desc="SupplierName"
                            >
                                <suggestionItems>
                                    <core:Item
                                        key="{Fornitore>Supplier}"
                                        text="{Fornitore>SupplierName}"
                                    />
                                </suggestionItems>
                            </MultiInput>
                        </fb:control>
                    </fb:FilterGroupItem>
                    <fb:FilterGroupItem
                        name="codFiscale"
                        label="Codice Fiscale"
                        groupName="codFiscale"
                        visibleInFilterBar="true"
                    >
                        <fb:control>
                            <Input
                                id="inputCodFiscale"
                                width="300px"
                                type="Text"
                            />
                        </fb:control>
                    </fb:FilterGroupItem>
                    <fb:FilterGroupItem
                        name="partitaIva"
                        label="Partita IVA"
                        groupName="partitaIva"
                        visibleInFilterBar="true"
                    >
                        <fb:control>
                            <Input
                                id="inputPartitaIva"
                                width="300px"
                                type="Text"
                            />
                        </fb:control>
                    </fb:FilterGroupItem>
                    <fb:FilterGroupItem
                        name="Tipo doc. AdE"
                        label="Tipo doc. AdE"
                        groupName="TipodocAdE"
                        visibleInFilterBar="true"
                    >
                        <fb:control>
                            <MultiInput
                                id="multiInputTipoDocAdE"
                                width="300px"
                                showValueHelp="true"
                                valueHelpRequest=".onValueHelpTipoDocAde"
                                showSuggestion="true"
                                suggestionItems="{path: 'TipoDocAde>/ZC_EIM_BLADE'}"
                                data-model="TipoDocAde"
                                data-key="BlartAde"
                                data-desc="Descrizione"
                            >
                                <suggestionItems>
                                    <core:Item
                                        key="{TipoDocAde>BlartAde}"
                                        text="{TipoDocAde>Descrizione}"
                                    />
                                </suggestionItems>
                            </MultiInput>
                        </fb:control>
                    </fb:FilterGroupItem>
                    <fb:FilterGroupItem
                        name="nrDoc"
                        label="Nr. docomento nel file XML"
                        groupName="nrDoc"
                        visibleInFilterBar="true"
                    >
                        <fb:control>
                            <Input
                                id="inputNrDoc"
                                width="300px"
                                type="Text"
                            />
                        </fb:control>
                    </fb:FilterGroupItem>
                    <fb:FilterGroupItem
                        name="Data"
                        label="Data Documento"
                        groupName="dataDoc"
                        visibleInFilterBar="true"
                    >
                        <fb:control>
                            <DateRangeSelection
                                id="dateRangePicker2"
                                delimiter=" - "
                                width="300px"
                                displayFormat="dd/MM/yyyy"
                                valueFormat="yyyy-MM-dd"
                            />
                        </fb:control>
                    </fb:FilterGroupItem>
                    <fb:FilterGroupItem
                        name="Data"
                        label="Data Ricezione"
                        groupName="dataRicezione"
                        visibleInFilterBar="true"
                    >
                        <fb:control>
                            <DateRangeSelection
                                id="dateRangePicker"
                                delimiter=" - "
                                width="300px"
                                displayFormat="dd/MM/yyyy"
                                valueFormat="yyyy-MM-dd"
                            />
                        </fb:control>
                    </fb:FilterGroupItem>
                    <fb:FilterGroupItem
                        name="codiceDestinatario"
                        label="Codice Destinatario"
                        groupName="codiceDestinatario"
                        visibleInFilterBar="true"
                    >
                        <fb:control>
                            <Input
                                id="inputCodiceDestinatario"
                                width="300px"
                                type="Text"
                            />
                        </fb:control>
                    </fb:FilterGroupItem>
                    <fb:FilterGroupItem
                        name="nrInvioSdi"
                        label="Nr. invio SDI"
                        groupName="nrInvioSdi"
                        visibleInFilterBar="true"
                    >
                        <fb:control>
                            <Input
                                id="inputNrInvioSdi"
                                width="300px"
                                type="Text"
                            />
                        </fb:control>
                    </fb:FilterGroupItem>
                </fb:filterGroupItems>
            </fb:FilterBar>
        </Panel>
        <!-- Elenco fatture -->
        <Panel
            headerText="Elenco Fatture"
            width="100%"
        >
            <IconTabBar
                id="idIconTabBar"
                select=".onIconTabSelect"
                expandable="false"
                expanded="false"
            >
                <items>
                    <!-- ALL -->
                    <IconTabFilter
                        key="All"
                        text="Fatture"
                        showAll="true"
                        count="{viewModel>/counts/All}"
                        icon="sap-icon://documents"
                        iconColor="Neutral"
                    />

                    <IconTabSeparator />

                    <!-- NON REGISTRABILI (0) -->
                    <IconTabFilter
                        key="NotAllowed"
                        text="Non registrabili"
                        icon="sap-icon://cancel"
                        iconColor="Neutral"
                        count="{viewModel>/counts/NotAllowed}"
                    />

                    <!-- DA REGISTRARE (1) -->
                    <IconTabFilter
                        key="Working"
                        text="Da registrare"
                        icon="sap-icon://timesheet"
                        iconColor="Negative"
                        count="{viewModel>/counts/Working}"
                    />

                    <!-- PARCHEGGIATE (2) -->
                    <IconTabFilter
                        key="Parked"
                        text="Parcheggiate"
                        icon="sap-icon://pending"
                        iconColor="Critical"
                        count="{viewModel>/counts/Parked}"
                    />

                    <!-- CONTABILIZZATE (3) -->
                    <IconTabFilter
                        key="Processed"
                        text="Contabilizzate"
                        icon="sap-icon://accept"
                        iconColor="Positive"
                        count="{viewModel>/counts/Processed}"
                    />
                </items>
            </IconTabBar>

            <table:Table
                id="idTreeTable"
                rows="{fattureModel>/results}"
                selectionMode="MultiToggle"
                enableColumnReordering="true"
                fixedColumnCount="1"
                rowActionCount="1"
                rowSelectionChange="onRowSelectionChange"
            >   
                <table:rowActionTemplate>
                    <table:RowAction>
                        <table:items>
                            <table:RowActionItem
                                icon="sap-icon://navigation-right-arrow"
                                text="Apri Dettaglio"
                                type="Navigation"
                                press=".onVisualizzaDati"
                            />
                        </table:items>
                    </table:RowAction>
                </table:rowActionTemplate>
                <table:rowSettingsTemplate>
                    <table:RowSettings
                        highlight="{path: 'status', formatter: '.getHighlight'}"
                    />
                </table:rowSettingsTemplate>
                <!-- Colonne (lascia invariato) -->
                <table:columns>
                    <table:Column width="5rem">
                        <table:label>
                            <Label text="Allegato" />
                        </table:label>
                        <table:template>
                            <Button
                                type="Transparent"
                                icon="sap-icon://attachment"
                                enabled="{= Boolean(${fattureModel>TipoAllegato}) &amp;&amp; ${fattureModel>TipoAllegato} !== '0' }"
                                tooltip="{path: 'fattureModel>TipoAllegato', formatter: '.formatter.allegatoText'}"
                                press=".onVisualizzaAllegato"
                            />
                        </table:template>
                    </table:Column>
                    <table:Column width="4rem">
                        <table:label>
                            <Label text="XML" />
                        </table:label>
                        <table:template>
                            <Button
                                type="Transparent"
                                icon="sap-icon://show"
                                press=".onVisualizzaXML"
                            />
                        </table:template>
                    </table:Column>

                    <table:Column width="4rem">
                        <table:label>
                            <Label text="Fattura" />
                        </table:label>
                        <table:template>
                            <Button
                                type="Transparent"
                                icon="sap-icon://pdf-attachment"
                                tooltip="Visualizza Fattura"
                                press=".onVisualizzaPDF"
                            />
                        </table:template>
                    </table:Column>

                    <!-- N. doc. (presente su padre e figlio) -->
                    <table:Column width="7rem">
                        <table:label>
                            <Label text="N. doc." />
                        </table:label>

                        <table:template>
                            <VBox renderType="Bare">
                                <Link
                                    text="{fattureModel>DocumentNumber}"
                                    press=".onDocumentNumberLinkPressConditional"
                                />
                            </VBox>
                        </table:template>
                    </table:Column>

                    <!-- Esercizio (solo testata, le righe figlie non ce l’hanno) -->
                    <table:Column width="6rem">
                        <table:label>
                            <Label text="Esercizio" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>FiscalYear}" />
                        </table:template>
                    </table:Column>
                    <!-- Eser St. (semaforo) -> visible solo se esiste 'status' -->
                    <table:Column width="6rem">
                        <table:label>
                            <Label text="Stato" />
                        </table:label>
                        <table:template>
                            <HBox
                                alignItems="Center"
                                justifyContent="Center"
                                visible="{= ${fattureModel>StatoFattura} ? true : false }"
                            >
                                <!-- '0' = Non registrabile -->
                                <core:Icon
                                    src="sap-icon://circle-task-2"
                                    size="1rem"
                                    color="{= ${fattureModel>StatoFattura} === '0' ? 'black' : 'lightgrey'}"
                                    tooltip="Non registrabile"
                                />

                                <!-- '1' = Da registrare -->
                                <core:Icon
                                    src="sap-icon://circle-task-2"
                                    size="1rem"
                                    color="{= ${fattureModel>StatoFattura} === '1' ? 'red' : 'lightgrey'}"
                                    tooltip="Da registrare"
                                />

                                <!-- '2' = Parcheggiata -->
                                <core:Icon
                                    src="sap-icon://circle-task-2"
                                    size="1rem"
                                    color="{= ${fattureModel>StatoFattura} === '2' ? 'orange' : 'lightgrey'}"
                                    tooltip="Parcheggiata"
                                />

                                <!-- '3' = Contabilizzata -->
                                <core:Icon
                                    src="sap-icon://circle-task-2"
                                    size="1rem"
                                    color="{= ${fattureModel>StatoFattura} === '3' ? 'green' : 'lightgrey'}"
                                    tooltip="Contabilizzata"
                                />
                            </HBox>
                        </table:template>
                    </table:Column>

                    <!-- Posizione (Figlio) -->
                    <table:Column width="9rem">
                        <table:label>
                            <Label text="Tipo Fattura" />
                        </table:label>
                        <table:template>
                            <Text
                                text="{= ${fattureModel>TipoFattura} === 'M' ? 'Fattura Logistica' : 'Fattura Contabile'}"
                            />
                        </table:template>
                    </table:Column>
                    <!-- Società -->
                    <table:Column width="6rem">
                        <table:label>
                            <Label text="Società" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>CompanyCode}" />
                        </table:template>
                    </table:Column>
                    <!-- Nome Società-->
                    <table:Column width="14rem">
                        <table:label>
                            <Label text="Nome della società" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>CompanyName}" />
                        </table:template>
                    </table:Column>
                    <!-- S. Fornitore -->
                    <table:Column width="4rem">
                        <table:label>
                            <Label text="Stato" />
                        </table:label>
                        <table:template>
                            <core:Icon
                                src="{ path: 'fattureModel>SupplierStatus', formatter: '.formatter.supplierStatusIconSrc' }"
                                tooltip="{ path: 'fattureModel>SupplierStatus', formatter: '.formatter.supplierStatusTooltip' }"
                            />
                        </table:template>
                    </table:Column>
                    <!-- Codice Fornitore -->
                    <table:Column width="6rem">
                        <table:label>
                            <Label text="Fornitore" />
                        </table:label>
                        <table:template>
                            <Link
                                text="{fattureModel>SupplierCode}"
                                press="onNavToFornitore"
                            />
                        </table:template>
                    </table:Column>
                    <!-- Nome Fornitore -->
                    <table:Column width="14rem">
                        <table:label>
                            <Label text="Nome Fornitore" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>SupplierName}" />
                        </table:template>
                    </table:Column>
                    <!-- Gruppo Conti -->
                    <!-- <table:Column width="14rem">
                        <table:label>
                            <Label text="Gruppo Conti" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>SupplAcctGroup}" />
                        </table:template>
                    </table:Column> -->
                    <!-- Tipo Documento Cod. -->
                    <table:Column width="6rem">
                        <table:label>
                            <Label text="Tipo Fatt" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>TipoDocAdE}" />
                        </table:template>
                    </table:Column>
                    <!-- Tipo Documento Descr. -->
                    <table:Column width="6rem">
                        <table:label>
                            <Label text="Descrizione" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>TipoDocText}" />
                        </table:template>
                    </table:Column>
                    <!-- numero fattura fornitore. -->
                    <table:Column width="14rem">
                        <table:label>
                            <Label text="N. Fat Fornitore" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>NumeroFattura}" />
                        </table:template>
                    </table:Column>
                    <!-- Data Fattura -->
                    <table:Column width="6rem">
                        <table:label>
                            <Label text="Data Fat" />
                        </table:label>
                        <table:template>
                            <Text
                                text="{path: 'fattureModel>DataFattura', formatter: '.formatter.formatDate'}"
                            />
                        </table:template>
                    </table:Column>
                    <!-- Divisa -->
                    <table:Column width="6rem">
                        <table:label>
                            <Label text="Divisa" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>Divisa}" />
                        </table:template>
                    </table:Column>

                    <!-- Causale -->
                    <table:Column width="14rem">
                        <table:label>
                            <Label text="Causale" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>Causale}" />
                        </table:template>
                    </table:Column>
                    <!-- Importo totale -->
                    <table:Column width="10rem">
                        <table:label>
                            <Label text="Importo totale" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>Totale}" />
                        </table:template>
                    </table:Column>
                    <!-- Imponibile -->
                    <table:Column width="10rem">
                        <table:label>
                            <Label text="Imponibile" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>Imponibile}" />
                        </table:template>
                    </table:Column>
                    <!-- Doc Contabile -->
                    <table:Column width="7rem">
                        <table:label>
                            <Label text="Doc Contabile" />
                        </table:label>

                        <table:template>
                            <VBox renderType="Bare">
                                <Link
                                    text="{fattureModel>FinanceDocument}"
                                    press="onFinanceDocumentLinkPress"
                                />
                            </VBox>
                        </table:template>
                    </table:Column>

                    <!-- Data registrazione -->
                    <table:Column width="8rem">
                        <table:label>
                            <Label text="Data registr." />
                        </table:label>
                        <table:template>
                            <Text
                                text="{path: 'fattureModel>PostingDate', formatter: '.formatter.formatDate'}"
                            />
                        </table:template>
                    </table:Column>
                    <!-- Tipo Documento SAP -->
                    <table:Column width="5rem">
                        <table:label>
                            <Label text="Tipo SAP" />
                        </table:label>
                        <table:template>
                            <Text text="{path: 'fattureModel>DocumentType'}" />
                        </table:template>
                    </table:Column>
                    <!-- Codice Destinatario SDI-->
                    <!-- <table:Column width="14rem">
                        <table:label>
                            <Label text="Codice Destinatario SDI" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>CodDestinatario}" />
                        </table:template>
                    </table:Column> -->
                    <!-- Numerdo SDI-->
                    <!-- <table:Column width="14rem">
                        <table:label>
                            <Label text="Numero SDI" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>NumeroSDI}" />
                        </table:template>
                    </table:Column> -->
                    <!-- Data ricevimento -->
                    <!-- <table:Column width="10rem">
                        <table:label>
                            <Label text="Data ricevimento" />
                        </table:label>
                        <table:template>
                            <Text
                                text="{path: 'fattureModel>DataSDI', formatter: '.formatter.formatDate'}"
                            />
                        </table:template>
                    </table:Column> -->
                    <!-- PIVA -->
                    <!-- <table:Column width="10rem">
                        <table:label>
                            <Label text="Partita IVA" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>PartitaIVAcee}" />
                        </table:template>
                    </table:Column> -->
                    <!-- Codice Fiscale-->
                    <!-- <table:Column width="10rem">
                        <table:label>
                            <Label text="Codice Fiscale" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>CodiceFiscale}" />
                        </table:template>
                    </table:Column> -->
                    <!-- Gruppo CM -->
                    <!-- <table:Column width="14rem">
                        <table:label>
                            <Label text="Gruppo CM" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>CashPlanGroup}" />
                        </table:template>
                    </table:Column> -->
                    <!-- Descrizione Gruppo CM -->
                    <!-- <table:Column width="14rem">
                        <table:label>
                            <Label text="Descrizione Gruppo CM" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>CashPlanGrpDescr}" />
                        </table:template>
                    </table:Column> -->
                    <!-- Paese -->
                    <!-- <table:Column width="8rem">
                        <table:label>
                            <Label text="Paese" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>Paese}" />
                        </table:template>
                    </table:Column> -->
                    <!-- Scadenza Pagamento -->
                    <table:Column width="8rem">
                        <table:label>
                            <Label text="Data Pagamento" />
                        </table:label>
                        <table:template>
                            <Text
                                text="{path: 'fattureModel>DataPagamento', formatter: '.formatter.formatDate'}"
                            />
                        </table:template>
                    </table:Column>
                    <!-- Motivazione Blocco -->
                    <table:Column width="14rem">
                        <table:label>
                            <Label text="Motivazione Blocco" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>MotivoBlocco}" />
                        </table:template>
                    </table:Column>
                    <!-- Blocco -->
                    <table:Column width="4rem">
                        <table:label>
                            <Label text="Blocco" />
                        </table:label>
                        <table:template>
                            <core:Icon
                                src="{= ${fattureModel>CodBlocco} ? 'sap-icon://locked' : 'sap-icon://unlocked' }"
                                tooltip="{= ${fattureModel>CodBlocco} ? 'Bloccato' : 'Sbloccato' }"
                            />
                        </table:template>
                    </table:Column>
                    <!-- Archiviato -->
                    <!-- <table:Column width="6rem">
                        <table:label>
                            <Label text="Archiviato" />
                        </table:label>
                        <table:template>
                            <Text text="{fattureModel>Archiviato}" />
                        </table:template>
                    </table:Column> -->
                </table:columns>
            </table:Table>
        </Panel>
        <!-- FOOTER -->
        <footer>
            <OverflowToolbar>
                <ToolbarSpacer />
                <!-- 1. OdA senza fattura -->
                <Button
                    text="OdA senza fattura"
                    icon="sap-icon://add-document"
                    press=".onOdaSenzaFattura"
                    type="Emphasized"
                />
                <!-- 3. Partitario Fornitore -->
                <Button
                    text="Partitario Fornitore"
                    icon="sap-icon://supplier"
                    press=".onPartitarioFornitore"
                    type="Emphasized"
                />
                <!-- 4. Fattura Logistica -->
                <Button
                    text="Fattura Logistica"
                    icon="sap-icon://shipping-status"
                    press=".onVisualizzaDati"
                    type="Emphasized"
                    enabled="{viewModel>/ui/canOpenCreateApps}"
                />
                <!-- 5. Fattura Contabile -->
                <Button
                    text="Fattura Contabile"
                    icon="sap-icon://expense-report"
                    press=".onFatturaContabile"
                    type="Emphasized"
                    enabled="{viewModel>/ui/canOpenCreateApps}"
                />
                <!-- 6. Lucchetto Blocco -->
                <Button
                    text="Blocca"
                    icon="sap-icon://locked"
                    tooltip="Blocca"
                    press=".onBloccaFattura"
                    type="Emphasized"
                    enabled="{= ${viewModel>/ui/canBlocca} }"
                />
                <!-- 7. Lucchetto Sblocco -->
                <Button
                    text="Sblocca"
                    icon="sap-icon://unlocked"
                    tooltip="Sblocca"
                    press=".onSbloccaFattura"
                    type="Emphasized"
                />
                <!-- 8. Archivia Fattura -->
                <Button
                    text="Archivia Fattura"
                    icon="sap-icon://save"
                    press=".onArchiviaFattura"
                    type="Emphasized"
                    enabled="{= ${viewModel>/ui/canArchivia} }"
                />
                <!-- 9. Storno Fattura -->
                <Button
                    text="Storno Fattura"
                    icon="sap-icon://reset"
                    press=".onStornoFattura"
                    type="Emphasized"
                    enabled="{= ${viewModel>/ui/canStorno} }"
                />
                <!-- 10. Annulla Archiviazione -->
                <Button
                    text="Annulla Archiviazione"
                    icon="sap-icon://sys-cancel-2"
                    press=".onAnnullaArchiviazione"
                    type="Emphasized"
                />
                <!-- 11. Fattura logistica MIRO -->
                <Button
                    text="Fattura logistica MIRO"
                    icon="sap-icon://doc-attachment"
                    press=".onFatturaLogisticaMiro"
                    type="Emphasized"
                    enabled="{viewModel>/ui/canOpenCreateApps}"
                />
            </OverflowToolbar>
        </footer>
    </Page>
</mvc:View>
