<mvc:View
    controllerName="com.zeim.fatturazionepassiva.controller.Dettaglio"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:m="sap.m"
    xmlns:uxap="sap.uxap"
    xmlns:layout="sap.ui.layout"
    xmlns:form="sap.ui.layout.form"
    xmlns:core="sap.ui.core"
>
    <m:Page
        id="paginaDettaglio"
        showFooter="true"
        class="sapUiSizeCompact"
    >
        <m:content>
            <uxap:ObjectPageLayout
                id="objectPageLayout"
                showTitleInHeaderContent="true"
                alwaysShowContentHeader="false"
                preserveHeaderStateOnScroll="false"
                headerContentPinnable="true"
                isChildPage="true"
                upperCaseAnchorBar="false"
            >
                <uxap:headerTitle>
                    <uxap:ObjectPageDynamicHeaderTitle>
                        <uxap:expandedHeading>
                            <m:HBox
                                width="100%"
                                justifyContent="SpaceBetween"
                                alignItems="Center"
                            >
                                <m:Title
                                    text="{= 'Fattura ' + (${DocumentNumber} || '')}"
                                    wrapping="true"
                                />
                            </m:HBox>
                        </uxap:expandedHeading>

                        <uxap:actions>
                            <m:OverflowToolbar>
                                <m:Button
                                    text="Attribuisci Oda"
                                    icon="sap-icon://attachment"
                                    press=".onAttribuisciOda"
                                    type="Emphasized"
                                    visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                />
                                <m:Button
                                    text="Attribuisci DDT"
                                    icon="sap-icon://chain-link"
                                    press=".onAttribuisciDDT"
                                    type="Emphasized"
                                    visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                />
                            </m:OverflowToolbar>
                        </uxap:actions>
                    </uxap:ObjectPageDynamicHeaderTitle>
                </uxap:headerTitle>

                <uxap:sections>
                    <!-- SEZIONE DATI TESTATA -->
                    <uxap:ObjectPageSection
                        id="datiTestataSection"
                        title="Dati testata"
                    >
                        <uxap:subSections>
                            <uxap:ObjectPageSubSection>
                                <uxap:blocks>
                                    <form:SimpleForm
                                        editable="false"
                                        labelSpanXL="4"
                                        labelSpanL="4"
                                        labelSpanM="4"
                                        labelSpanS="12"
                                        adjustLabelSpan="false"
                                        emptySpanXL="0"
                                        emptySpanL="0"
                                        emptySpanM="0"
                                        emptySpanS="0"
                                        columnsXL="4"
                                        columnsL="3"
                                        columnsM="2"
                                        columnsS="1"
                                        width="100%"
                                    >
                                        <!-- DOCUMENTO -->
                                        <core:Title text="Documento" />

                                        <m:Label text="Società" />
                                        <m:Text text="{CompanyCode}" />

                                        <m:Label text="Nome società" />
                                        <m:Text text="{CompanyName}" />

                                        <m:Label text="Tipo Doc. AdE" />
                                        <m:Text text="{TipoDocAdE}" />

                                        <m:Label text="Descrizione Tipo Doc." />
                                        <m:Text text="{TipoDocText}" />

                                        <m:Label text="Tipo fattura" />
                                        <m:Text
                                            text="{= ${TipoFattura} === 'M' ? 'Fattura Logistica' : 'Fattura Contabile' }"
                                        />

                                        <m:Label text="Esercizio" />
                                        <m:Text text="{FiscalYear}" />

                                        <m:Label text="Tipo documento SAP" />
                                        <m:Text text="{DocumentType}" />

                                        <m:Label text="Doc. contabile" />
                                        <m:Link
                                            text="{FinanceDocument}"
                                            press="onFinanceDocumentLinkPress"
                                        />

                                        <m:Label text="Data registrazione" />
                                        <m:Text
                                            text="{path: 'PostingDate', formatter: '.formatter.formatDate'}"
                                        />

                                        <!-- FORNITORE -->
                                        <core:Title text="Fornitore" />

                                        <m:Label text="Codice" />
                                        <m:Link
                                            text="{SupplierCode}"
                                            press="onNavToFornitore"
                                        />

                                        <m:Label text="Nome" />
                                        <m:Text text="{SupplierName}" />

                                        <m:Label text="Partita IVA" />
                                        <m:Text text="{PartitaIVAcee}" />

                                        <m:Label text="Codice fiscale" />
                                        <m:Text text="{CodiceFiscale}" />

                                        <m:Label text="N. fattura fornitore" />
                                        <m:Text text="{NumeroFattura}" />

                                        <m:Label text="Data fattura" />
                                        <m:Text
                                            text="{path: 'DataFattura', formatter: '.formatter.formatDate'}"
                                        />

                                        <m:Label text="Causale" />
                                        <m:Text text="{Causale}" />

                                        <!-- SDI E STATO -->
                                        <core:Title text="SDI e Stato" />

                                        <m:Label text="Codice destinatario" />
                                        <m:Text text="{CodDestinatario}" />

                                        <m:Label text="Numero SDI" />
                                        <m:Text text="{NumeroSDI}" />

                                        <m:Label text="Data ricezione SDI" />
                                        <m:Text
                                            text="{path: 'DataSDI', formatter: '.formatter.formatDate'}"
                                        />

                                        <m:Label text="Paese" />
                                        <m:Text text="{Paese}" />

                                        <m:Label text="Blocco" />
                                        <m:Text
                                            text="{= ${CodBlocco} ? 'Bloccato' : 'Sbloccato' }"
                                        />

                                        <m:Label text="Motivo blocco" />
                                        <m:Text text="{MotivoBlocco}" />

                                        <!-- IMPORTI -->
                                        <core:Title text="Importi" />

                                        <m:Label text="Imponibile" />
                                        <m:Text text="{Imponibile}" />

                                        <m:Label text="Totale" />
                                        <m:Text text="{Totale}" />

                                        <m:Label text="Divisa" />
                                        <m:Text text="{Divisa}" />
                                        
                                        <m:Label text="Data pagamento" />
                                        <m:Text
                                            text="{path: 'DataPagamento', formatter: '.formatter.formatDate'}"
                                        />
                                    </form:SimpleForm>
                                </uxap:blocks>
                            </uxap:ObjectPageSubSection>
                        </uxap:subSections>
                    </uxap:ObjectPageSection>

                    <!-- SEZIONE DETTAGLIO RIGHE -->
                    <uxap:ObjectPageSection
                        id="dettaglioRigheSection"
                        title="Dettaglio righe"
                    >
                        <uxap:subSections>
                            <uxap:ObjectPageSubSection>
                                <uxap:blocks>
                                    <m:ScrollContainer
                                        horizontal="true"
                                        vertical="false"
                                        width="100%"
                                        focusable="true"
                                    >
                                        <m:Table
                                            id="detailTable"
                                            items="{path: 'fattura>/FatturaElettronicaBody/DatiBeniServizi/DettaglioLinee'}"
                                            inset="false"
                                            width="100%"
                                        >
                                            <m:columns>
                                                <m:Column width="6rem">
                                                    <m:Text text="Posizione" />
                                                </m:Column>
                                                <m:Column width="6rem">
                                                    <m:Text text="M.For/CACC" />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Codice Materiale SAP"
                                                    />
                                                </m:Column>
                                                <m:Column width="12rem">
                                                    <m:Text
                                                        text="Descrizione Materiale"
                                                    />
                                                </m:Column>
                                                <m:Column width="8rem">
                                                    <m:Text
                                                        text="Unità di misura"
                                                    />
                                                </m:Column>
                                                <m:Column width="6rem">
                                                    <m:Text text="Quantità" />
                                                </m:Column>
                                                <m:Column width="6rem">
                                                    <m:Text
                                                        text="Prezzo Unitario"
                                                    />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Prezzo Totale"
                                                    />
                                                </m:Column>
                                                <m:Column width="5rem">
                                                    <m:Text
                                                        text="Cod. IVA (%)"
                                                    />
                                                </m:Column>
                                                <m:Column width="5rem">
                                                    <m:Text text="OdA" />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Doc. Acquisto"
                                                    />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Posizione Oda"
                                                    />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text text="Data Doc." />
                                                </m:Column>
                                                <m:Column width="5rem">
                                                    <m:Text text="DDT" />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Doc. Materiale"
                                                    />
                                                </m:Column>
                                                <m:Column width="5rem">
                                                    <m:Text text="Posizione" />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text text="Es.doc.mat" />
                                                </m:Column>
                                                <m:Column width="4rem">
                                                    <m:Text text="CUP" />
                                                </m:Column>
                                                <m:Column width="4rem">
                                                    <m:Text text="CIG" />
                                                </m:Column>
                                                <m:Column width="6rem">
                                                    <m:Text text="Commessa" />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Bolla consegna"
                                                    />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Data di registrazione"
                                                    />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text text="N. Doc" />
                                                </m:Column>
                                            </m:columns>

                                            <m:items>
                                                <m:ColumnListItem>
                                                    <m:cells>
                                                        <m:Text
                                                            text="{fattura>NumeroLinea}"
                                                        />
                                                        <m:Text
                                                            text="{matFornCcac}"
                                                        />

                                                        <m:VBox
                                                            renderType="Bare"
                                                        >
                                                            <m:Input
                                                                value="{materialCode}"
                                                                valueState="{= ${materialCode} ? 'Success' : 'Error' }"
                                                                visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                                                width="100%"
                                                            />
                                                            <m:Text
                                                                text="{materialCode}"
                                                                visible="{= ${viewModel>/ui/mode} !== 'edit' }"
                                                            />
                                                        </m:VBox>

                                                        <m:Text
                                                            text="{fattura>Descrizione}"
                                                        />

                                                        <m:VBox
                                                            renderType="Bare"
                                                        >
                                                            <m:Input
                                                                value="{fattura>UnitaMisura}"
                                                                valueState="{= ${fattura>UnitaMisura} ? 'Success' : 'Error' }"
                                                                visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                                                width="100%"
                                                            />
                                                            <m:Text
                                                                text="{fattura>UnitaMisura}"
                                                                visible="{= ${viewModel>/ui/mode} !== 'edit' }"
                                                            />
                                                        </m:VBox>

                                                        <m:Text
                                                            text="{fattura>Quantita}"
                                                        />
                                                        <m:Text
                                                            text="{fattura>PrezzoUnitario}"
                                                        />
                                                        <m:Text
                                                            text="{fattura>PrezzoTotale}"
                                                        />
                                                        <m:Text
                                                            text="{fattura>AliquotaIVA}"
                                                        />

                                                        <m:Button
                                                            icon="sap-icon://action"
                                                            enabled="{= ${viewModel>/ui/mode} === 'edit' }"
                                                        />
                                                        <m:Link
                                                            text="{fattura>odaIdDocumento}"
                                                            href="https://example.com/docAcq/{docAcq}"
                                                        />

                                                        <m:VBox
                                                            renderType="Bare"
                                                        >
                                                            <m:Input
                                                                value="{fattura>odaPosOda}"
                                                                valueState="{= ${fattura>odaPosOda} ? 'Success' : 'Error' }"
                                                                visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                                                width="100%"
                                                            />
                                                            <m:Text
                                                                text="{fattura>odaPosOda}"
                                                                visible="{= ${viewModel>/ui/mode} !== 'edit' }"
                                                            />
                                                        </m:VBox>

                                                        <m:Text
                                                            text="{fattura>odaDataDoc}"
                                                        />

                                                        <m:Button
                                                            icon="sap-icon://action"
                                                            enabled="{= ${viewModel>/ui/mode} === 'edit' }"
                                                        />

                                                        <m:VBox
                                                            renderType="Bare"
                                                        >
                                                            <m:Input
                                                                value="{docMat}"
                                                                valueState="{= ${docMat} ? 'Success' : 'Error' }"
                                                                visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                                                width="100%"
                                                            />
                                                            <m:Text
                                                                text="{docMat}"
                                                                visible="{= ${viewModel>/ui/mode} !== 'edit' }"
                                                            />
                                                        </m:VBox>

                                                        <m:VBox
                                                            renderType="Bare"
                                                        >
                                                            <m:Input
                                                                value="{posDocMat}"
                                                                valueState="{= ${posDocMat} ? 'Success' : 'Error' }"
                                                                visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                                                width="100%"
                                                            />
                                                            <m:Text
                                                                text="{posDocMat}"
                                                                visible="{= ${viewModel>/ui/mode} !== 'edit' }"
                                                            />
                                                        </m:VBox>

                                                        <m:VBox
                                                            renderType="Bare"
                                                        >
                                                            <m:Input
                                                                value="{esDocMat}"
                                                                valueState="{= ${esDocMat} ? 'Success' : 'Error' }"
                                                                visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                                                width="100%"
                                                            />
                                                            <m:Text
                                                                text="{esDocMat}"
                                                                visible="{= ${viewModel>/ui/mode} !== 'edit' }"
                                                            />
                                                        </m:VBox>

                                                        <m:Text text="{cup}" />
                                                        <m:Text text="{cig}" />
                                                        <m:Text
                                                            text="{commessa}"
                                                        />
                                                        <m:Text
                                                            text="{bolla}"
                                                        />
                                                        <m:Text text="-" />
                                                        <m:Text text="-" />
                                                    </m:cells>
                                                </m:ColumnListItem>
                                            </m:items>
                                        </m:Table>
                                    </m:ScrollContainer>
                                </uxap:blocks>
                            </uxap:ObjectPageSubSection>
                        </uxap:subSections>
                    </uxap:ObjectPageSection>
                </uxap:sections>
            </uxap:ObjectPageLayout>
        </m:content>

        <m:footer>
            <m:OverflowToolbar>
                <m:ToolbarSpacer />

                <m:Button
                    text="PreAcquisire (Qta e Prz da file)"
                    icon="sap-icon://warning"
                    type="Emphasized"
                    press=".onPreAcquisireFile"
                    visible="{= ${viewModel>/ui/mode} === 'edit' }"
                />
                <m:Button
                    text="PreAcquisire dati da Oda Sap"
                    icon="sap-icon://download"
                    press=".onPreAcquisireOdaSap"
                    type="Emphasized"
                    visible="{= ${viewModel>/ui/mode} === 'edit' }"
                />
                <m:Button
                    text="PreAcquisire dati da DDT Sap"
                    icon="sap-icon://download"
                    press=".onPreAcquisireDdtSap"
                    type="Emphasized"
                    visible="{= ${viewModel>/ui/mode} === 'edit' }"
                />

                <m:Button
                    icon="sap-icon://decline"
                    text="Annulla / Esci"
                    press="onBackToHome"
                />
            </m:OverflowToolbar>
        </m:footer>
    </m:Page>
</mvc:View>
