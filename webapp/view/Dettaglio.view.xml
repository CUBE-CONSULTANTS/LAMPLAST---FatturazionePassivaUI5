<mvc:View
    controllerName="com.zeim.fatturazionepassiva.controller.Dettaglio"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:m="sap.m"
    xmlns:uxap="sap.uxap"
    xmlns:layout="sap.ui.layout"
    
>
    <m:Page
        id="paginaDettaglio"
        showFooter="true"
        class="sapUiSizeCompact"
        title="Fattura"
    >
        <m:content>
            <uxap:ObjectPageLayout
                id="objectPageLayout"
                showTitleInHeaderContent="true"
                alwaysShowContentHeader="false"
                preserveHeaderStateOnScroll="false"
                headerContentPinnable="true"
                isChildPage="true"
                upperCaseAnchorBar="false"
            >
                <uxap:headerTitle>
                    <uxap:ObjectPageDynamicHeaderTitle>
                        <uxap:expandedHeading>
                            <m:Title
                                text="{= 'Fattura ' + (${DocumentNumber} || '')}"
                                wrapping="true"
                            />
                        </uxap:expandedHeading>

                        <uxap:actions>
                            <m:OverflowToolbar>
                                <m:Button
                                    text="Attribuisci Oda"
                                    icon="sap-icon://attachment"
                                    press=".onAttribuisciOda"
                                    type="Emphasized"
                                    visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                />
                                <m:Button
                                    text="Attribuisci DDT"
                                    icon="sap-icon://chain-link"
                                    press=".onAttribuisciDDT"
                                    type="Emphasized"
                                    visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                />
                            </m:OverflowToolbar>
                        </uxap:actions>
                    </uxap:ObjectPageDynamicHeaderTitle>
                </uxap:headerTitle>

                <uxap:headerContent>
                    <m:FlexBox wrap="Wrap">
                        <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                            <m:ObjectStatus
                                title="Tipo Documento"
                                text="{TipoDocAdE}"
                            />
                            <m:ObjectStatus
                                title="Descrizione Tipo Doc."
                                text="{TipoDocText}"
                            />
                            <m:ObjectStatus
                                title="Società"
                                text="{CompanyCode}"
                            />
                            <m:ObjectStatus
                                title="Data Fattura"
                                text="{path: 'DataFattura', formatter: '.formatter.formatDate'}"
                            />
                        </layout:VerticalLayout>

                        <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                            <m:ObjectStatus
                                title="Fornitore"
                                text="{SupplierCode}"
                            />
                            <m:ObjectStatus
                                title="Nome"
                                text="{SupplierName}"
                            />
                            <m:ObjectStatus
                                title="Riferimento"
                                text="{NumeroFattura}"
                            />
                        </layout:VerticalLayout>
                    </m:FlexBox>
                </uxap:headerContent>

                <uxap:sections>
                    <uxap:ObjectPageSection
                        showTitle="false"
                        title="Dettaglio Fattura"
                    >
                        <uxap:subSections>
                            <uxap:ObjectPageSubSection>
                                <uxap:blocks>
                                    <m:ScrollContainer
                                        horizontal="true"
                                        vertical="false"
                                        width="100%"
                                        focusable="true"
                                    >
                                        <m:Table
                                            id="detailTable"
                                            items="{path: 'fattura>/FatturaElettronicaBody/DatiBeniServizi/DettaglioLinee'}"
                                            inset="false"
                                            width="100%"
                                        >
                                            <m:columns>
                                                <m:Column width="6rem">
                                                    <m:Text text="Posizione" />
                                                </m:Column>
                                                <m:Column width="6rem">
                                                    <m:Text text="M.For/CACC" />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Codice Materiale SAP"
                                                    />
                                                </m:Column>
                                                <m:Column width="12rem">
                                                    <m:Text
                                                        text="Descrizione Materiale"
                                                    />
                                                </m:Column>
                                                <m:Column width="8rem">
                                                    <m:Text
                                                        text="Unità di misura"
                                                    />
                                                </m:Column>
                                                <m:Column width="6rem">
                                                    <m:Text text="Quantità" />
                                                </m:Column>
                                                <m:Column width="6rem">
                                                    <m:Text
                                                        text="Prezzo Unitario"
                                                    />
                                                </m:Column>

                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Prezzo Totale"
                                                    />
                                                </m:Column>

                                                <m:Column width="5rem">
                                                    <m:Text
                                                        text="Cod. IVA (%)"
                                                    />
                                                </m:Column>
                                                <m:Column width="5rem">
                                                    <m:Text text="OdA" />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Doc. Acquisto"
                                                    />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Posizione Oda"
                                                    />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text text="Data Doc." />
                                                </m:Column>
                                                <m:Column width="5rem">
                                                    <m:Text text="DDT" />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Doc. Materiale"
                                                    />
                                                </m:Column>
                                                <m:Column width="5rem">
                                                    <m:Text text="Posizione" />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text text="Es.doc.mat" />
                                                </m:Column>
                                                <m:Column width="4rem">
                                                    <m:Text text="CUP" />
                                                </m:Column>
                                                <m:Column width="4rem">
                                                    <m:Text text="CIG" />
                                                </m:Column>
                                                <m:Column width="6rem">
                                                    <m:Text text="Commessa" />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Bolla consegna"
                                                    />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Data di registrazione"
                                                    />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text text="N. Doc" />
                                                </m:Column>
                                            </m:columns>

                                            <m:items>
                                                <m:ColumnListItem>
                                                    <m:cells>
                                                        <m:Text
                                                            text="{fattura>NumeroLinea}"
                                                        />
                                                        <m:Text
                                                            text="{matFornCcac}"
                                                        />

                                                        <!-- Codice Materiale SAP (1 cella, edit/display dentro VBox) -->
                                                        <m:VBox
                                                            renderType="Bare"
                                                        >
                                                            <m:Input
                                                                value="{materialCode}"
                                                                valueState="{= ${materialCode} ? 'Success' : 'Error' }"
                                                                visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                                                width="100%"
                                                            />
                                                            <m:Text
                                                                text="{= ${materialCode} ? ${materialCode} : '' }"
                                                                visible="{= ${viewModel>/ui/mode} !== 'edit' }"
                                                                wrapping="false"
                                                            />
                                                        </m:VBox>

                                                        <m:Text
                                                            text="{fattura>Descrizione}"
                                                        />

                                                        <!-- Unità di misura -->
                                                        <m:VBox
                                                            renderType="Bare"
                                                        >
                                                            <m:Input
                                                                value="{fattura>UnitaMisura}"
                                                                valueState="{= ${fattura>UnitaMisura} ? 'Success' : 'Error' }"
                                                                visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                                                width="100%"
                                                            />
                                                            <m:Text
                                                                text="{= ${fattura>UnitaMisura} ? ${fattura>UnitaMisura} : '' }"
                                                                visible="{= ${viewModel>/ui/mode} !== 'edit' }"
                                                                wrapping="false"
                                                            />
                                                        </m:VBox>

                                                        <m:Text
                                                            text="{fattura>Quantita}"
                                                        />
                                                        <m:Text
                                                            text="{fattura>PrezzoUnitario}"
                                                        />
                                                        <m:Text
                                                            text="{fattura>PrezzoTotale}"
                                                        />
                                                        <m:Text
                                                            text="{fattura>AliquotaIVA}"
                                                        />

                                                        <!-- OdA action -->
                                                        <m:Button
                                                            icon="sap-icon://action"
                                                            enabled="{= ${viewModel>/ui/mode} === 'edit' }"
                                                        />

                                                        <m:Link
                                                            text="{fattura>odaIdDocumento}"
                                                            href="https://example.com/docAcq/{docAcq}"
                                                        />

                                                        <!-- Posizione Oda -->
                                                        <m:VBox
                                                            renderType="Bare"
                                                        >
                                                            <m:Input
                                                                value="{fattura>odaPosOda}"
                                                                valueState="{= ${fattura>odaPosOda} ? 'Success' : 'Error' }"
                                                                visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                                                width="100%"
                                                            />
                                                            <m:Text
                                                                text="{= ${fattura>odaPosOda} ? ${fattura>odaPosOda} : '' }"
                                                                visible="{= ${viewModel>/ui/mode} !== 'edit' }"
                                                                wrapping="false"
                                                            />
                                                        </m:VBox>

                                                        <m:Text
                                                            text="{fattura>odaDataDoc}"
                                                        />

                                                        <!-- DDT action -->
                                                        <m:Button
                                                            icon="sap-icon://action"
                                                            enabled="{= ${viewModel>/ui/mode} === 'edit' }"
                                                        />

                                                        <!-- Doc. Materiale -->
                                                        <m:VBox
                                                            renderType="Bare"
                                                        >
                                                            <m:Input
                                                                value="{docMat}"
                                                                valueState="{= ${docMat} ? 'Success' : 'Error' }"
                                                                visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                                                width="100%"
                                                            />
                                                            <m:Text
                                                                text="{= ${docMat} ? ${docMat} : '' }"
                                                                visible="{= ${viewModel>/ui/mode} !== 'edit' }"
                                                                wrapping="false"
                                                            />
                                                        </m:VBox>

                                                        <!-- Posizione -->
                                                        <m:VBox
                                                            renderType="Bare"
                                                        >
                                                            <m:Input
                                                                value="{posDocMat}"
                                                                valueState="{= ${posDocMat} ? 'Success' : 'Error' }"
                                                                visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                                                width="100%"
                                                            />
                                                            <m:Text
                                                                text="{= ${posDocMat} ? ${posDocMat} : '' }"
                                                                visible="{= ${viewModel>/ui/mode} !== 'edit' }"
                                                                wrapping="false"
                                                            />
                                                        </m:VBox>

                                                        <!-- Es.doc.mat -->
                                                        <m:VBox
                                                            renderType="Bare"
                                                        >
                                                            <m:Input
                                                                value="{esDocMat}"
                                                                valueState="{= ${esDocMat} ? 'Success' : 'Error' }"
                                                                visible="{= ${viewModel>/ui/mode} === 'edit' }"
                                                                width="100%"
                                                            />
                                                            <m:Text
                                                                text="{= ${esDocMat} ? ${esDocMat} : '' }"
                                                                visible="{= ${viewModel>/ui/mode} !== 'edit' }"
                                                                wrapping="false"
                                                            />
                                                        </m:VBox>

                                                        <m:Text
                                                            text="{= ${cup} ? ${cup} : '' }"
                                                        />
                                                        <m:Text
                                                            text="{= ${cig} ? ${cig} : '' }"
                                                        />
                                                        <m:Text
                                                            text="{= ${commessa} ? ${commessa} : '' }"
                                                        />
                                                        <m:Text
                                                            text="{= ${bolla} ? ${bolla} : '' }"
                                                        />
                                                        <m:Text text="-" />
                                                        <m:Text text="-" />
                                                    </m:cells>
                                                </m:ColumnListItem>
                                            </m:items>
                                        </m:Table>
                                    </m:ScrollContainer>
                                </uxap:blocks>
                            </uxap:ObjectPageSubSection>
                        </uxap:subSections>
                    </uxap:ObjectPageSection>
                </uxap:sections>
            </uxap:ObjectPageLayout>
        </m:content>

        <m:footer>
            <m:OverflowToolbar>
                <m:ToolbarSpacer />

                <m:Button
                    text="PreAcquisire (Qta e Prz da file)"
                    icon="sap-icon://warning"
                    type="Emphasized"
                    press=".onPreAcquisireFile"
                    visible="{= ${viewModel>/ui/mode} === 'edit' }"
                />
                <m:Button
                    text="PreAcquisire dati da Oda Sap"
                    icon="sap-icon://download"
                    press=".onPreAcquisireOdaSap"
                    type="Emphasized"
                    visible="{= ${viewModel>/ui/mode} === 'edit' }"
                />
                <m:Button
                    text="PreAcquisire dati da DDT Sap"
                    icon="sap-icon://download"
                    press=".onPreAcquisireDdtSap"
                    type="Emphasized"
                    visible="{= ${viewModel>/ui/mode} === 'edit' }"
                />

                <m:Button
                    icon="sap-icon://decline"
                    text="Annulla / Esci"
                    press="onBackToHome"
                />
            </m:OverflowToolbar>
        </m:footer>
    </m:Page>
</mvc:View>
