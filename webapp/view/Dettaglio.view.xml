<mvc:View
    controllerName="com.zeim.fatturazionepassiva.controller.Dettaglio"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:m="sap.m"
    xmlns:uxap="sap.uxap"
    xmlns:layout="sap.ui.layout"
    xmlns:core="sap.ui.core"
>
    <!-- Pagina principale con footer fisso -->
    <m:Page
        id="paginaDettaglio"
        showFooter="true"
        class="sapUiSizeCompact"
    >
        <!-- === CONTENUTO PRINCIPALE === -->
        <m:content>
            <uxap:ObjectPageLayout
                id="objectPageLayout"
                showTitleInHeaderContent="true"
                alwaysShowContentHeader="false"
                preserveHeaderStateOnScroll="false"
                headerContentPinnable="true"
                isChildPage="true"
                upperCaseAnchorBar="false"
            >
                <!-- HEADER TITLE -->
                <uxap:headerTitle>
                    <uxap:ObjectPageDynamicHeaderTitle>
                        <uxap:expandedHeading>
                            <m:Title
                                text="{= 'Fattura ' + (${/SelectedInvoice/docNumber} || '')}"
                                wrapping="true"
                            />
                        </uxap:expandedHeading>

                        <uxap:actions>
                            <m:OverflowToolbar>
                                <m:Button
                                    text="Attribuisci Oda"
                                    icon="sap-icon://attachment"
                                    press=".onAttribuisciOda"
                                    type="Emphasized"
                                />
                                <m:Button
                                    text="Attribuisci DDT"
                                    icon="sap-icon://chain-link"
                                    press=".onAttribuisciDDT"
                                    type="Emphasized"
                                />
                                <m:Button
                                    text="PreAcquisire (Qta e Prz da file)"
                                    icon="sap-icon://warning"
                                    type="Emphasized"
                                    press=".onPreAcquisireFile"
                                />
                                <m:Button
                                    text="PreAcquisire dati da Oda Sap"
                                    icon="sap-icon://download"
                                    press=".onPreAcquisireOdaSap"
                                    type="Emphasized"
                                />
                                <m:Button
                                    text="PreAcquisire dati da DDT Sap"
                                    icon="sap-icon://download"
                                    press=".onPreAcquisireDdtSap"
                                    type="Emphasized"
                                />
                            </m:OverflowToolbar>
                        </uxap:actions>
                    </uxap:ObjectPageDynamicHeaderTitle>
                </uxap:headerTitle>

                <!-- HEADER CONTENT -->
                <uxap:headerContent>
                    <m:FlexBox wrap="Wrap">
                        <!-- COLONNA SINISTRA -->
                        <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                            <m:ObjectStatus
                                title="Tipo Documento"
                                text="{TipoDocAdE}"
                            />
                            <m:ObjectStatus
                                title="Descrizione Tipo Doc."
                                text="{TipoDocText}"
                            />
                            <m:ObjectStatus
                                title="Società"
                                text="{CompanyCode}"
                            />
                            <m:ObjectStatus
                                title="Data Fattura"
                                text="{path: 'DataFattura', formatter: '.formatter.formatDate'}"
                            />
                        </layout:VerticalLayout>

                        <!-- COLONNA DESTRA -->
                        <layout:VerticalLayout class="sapUiSmallMarginBeginEnd">
                            <m:ObjectStatus
                                title="Fornitore"
                                text="{SupplierCode}"
                            />
                            <m:ObjectStatus
                                title="Nome"
                                text="{SupplierName}"
                            />
                            <m:ObjectStatus
                                title="Riferimento"
                                text="{NumeroFattura}"
                            />
                        </layout:VerticalLayout>
                    </m:FlexBox>
                </uxap:headerContent>

                <!-- SEZIONI -->
                <uxap:sections>
                    <uxap:ObjectPageSection
                        showTitle="false"
                        title="Dettaglio Fattura"
                    >
                        <uxap:subSections>
                            <uxap:ObjectPageSubSection>
                                <uxap:blocks>
                                    <m:ScrollContainer
                                        horizontal="true"
                                        vertical="false"
                                        width="100%"
                                        focusable="true"
                                    >
                                        <m:Table
                                            id="detailTable"
                                            items="{path: 'fattura>/FatturaElettronicaBody/DatiBeniServizi/DettaglioLinee'}"
                                            inset="false"
                                            width="100%"
                                        >
                                            <m:columns>
                                                <m:Column width="6rem">
                                                    <m:Text text="Posizione" />
                                                </m:Column>
                                                <m:Column width="6rem">
                                                    <m:Text text="M.For/CACC" />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Codice Materiale SAP"
                                                    />
                                                </m:Column>
                                                <m:Column width="12rem">
                                                    <m:Text
                                                        text="Descrizione Materiale"
                                                    />
                                                </m:Column>
                                                <m:Column width="8rem">
                                                    <m:Text
                                                        text="Unità di misura"
                                                    />
                                                </m:Column>
                                                <m:Column width="6rem">
                                                    <m:Text text="Quantità" />
                                                </m:Column>
                                                <m:Column width="6rem">
                                                    <m:Text
                                                        text="Prezzo Unitario"
                                                    />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Prezzo Totale"
                                                    />
                                                    <m:footer>
                                                        <m:Text
                                                            text="{
                                                                path: '/SelectedInvoice/totalSum',
                                                                formatter: '.formatCurrency'
                                                            }"
                                                        />
                                                    </m:footer>
                                                </m:Column>
                                                <m:Column width="5rem">
                                                    <m:Text
                                                        text="Cod. IVA (%)"
                                                    />
                                                </m:Column>
                                                <m:Column width="5rem">
                                                    <m:Text text="OdA" />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Doc. Acquisto"
                                                    />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Posizione Oda"
                                                    />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text text="Data Doc." />
                                                </m:Column>
                                                <m:Column width="5rem">
                                                    <m:Text text="DDT" />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Doc. Materiale"
                                                    />
                                                </m:Column>
                                                <m:Column width="5rem">
                                                    <m:Text text="Posizione" />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text text="Es.doc.mat" />
                                                </m:Column>
                                                <m:Column width="4rem">
                                                    <m:Text text="CUP" />
                                                </m:Column>
                                                <m:Column width="4rem">
                                                    <m:Text text="CIG" />
                                                </m:Column>
                                                <m:Column width="6rem">
                                                    <m:Text text="Commessa" />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Bolla consegna"
                                                    />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text
                                                        text="Data di registrazione"
                                                    />
                                                </m:Column>
                                                <m:Column width="7rem">
                                                    <m:Text text="N. Doc" />
                                                </m:Column>
                                            </m:columns>

                                            <m:items>
                                                <m:ColumnListItem>
                                                    <m:cells>
                                                        <m:Text
                                                            text="{fattura>NumeroLinea}"
                                                        />
                                                        <m:Text
                                                            text="{matFornCcac}"
                                                        />
                                                        <m:Input
                                                            value="{materialCode}"
                                                            valueState="{= ${materialCode} ? 'Success' : 'Error' }"
                                                        />
                                                        <m:Text
                                                            text="{fattura>Descrizione}"
                                                        />
                                                        <m:Input
                                                            value="{fattura>UnitaMisura}"
                                                            valueState="{= ${fattura>UnitaMisura} ? 'Success' : 'Error' }"
                                                        />
                                                        <m:Text
                                                            text="{fattura>Quantita}"
                                                        />
                                                        <m:Text
                                                            text="{fattura>PrezzoUnitario}"
                                                        />
                                                        <m:Text
                                                            text="{fattura>PrezzoTotale}"
                                                        />
                                                        <m:Text
                                                            text="{fattura>AliquotaIVA}"
                                                        />
                                                        <m:Button
                                                            icon="sap-icon://action"
                                                        />
                                                        <m:Link
                                                            text="{fattura>odaIdDocumento}"
                                                            href="https://example.com/docAcq/{docAcq}"
                                                        />
                                                        <m:Input
                                                            value="{fattura>odaPosOda}"
                                                            valueState="{= ${fattura>odaPosOda} ? 'Success' : 'Error' }"
                                                        />
                                                        <m:Text
                                                            text="{fattura>odaDataDoc}"
                                                        />
                                                        <m:Button
                                                            icon="sap-icon://action"
                                                        />
                                                        <m:Input
                                                            value="{docMat}"
                                                            valueState="{= ${docMat} ? 'Success' : 'Error' }"
                                                        />
                                                        <m:Input
                                                            value="{posDocMat}"
                                                            valueState="{= ${posDocMat} ? 'Success' : 'Error' }"
                                                        />
                                                        <m:Input
                                                            value="{esDocMat}"
                                                            valueState="{= ${esDocMat} ? 'Success' : 'Error' }"
                                                        />
                                                        <m:Text text="{cup}" />
                                                        <m:Text text="{cig}" />
                                                        <m:Text
                                                            text="{commessa}"
                                                        />
                                                        <m:Text
                                                            text="{bolla}"
                                                        />
                                                    </m:cells>
                                                </m:ColumnListItem>
                                            </m:items>
                                        </m:Table>
                                    </m:ScrollContainer>
                                </uxap:blocks>
                            </uxap:ObjectPageSubSection>
                        </uxap:subSections>
                    </uxap:ObjectPageSection>
                </uxap:sections>
            </uxap:ObjectPageLayout>
        </m:content>

        <!-- === FOOTER FISSO === -->
        <m:footer>
            <m:OverflowToolbar>
                <m:ToolbarSpacer />
                <m:Button
                    icon="sap-icon://accept"
                    text="Esegui"
                    type="Emphasized"
                    press=".onEseguiPress"
                />
                <m:Button
                    icon="sap-icon://decline"
                    text="Annulla"
                    press=".onAnnullaPress"
                />
            </m:OverflowToolbar>
        </m:footer>
    </m:Page>
</mvc:View>
